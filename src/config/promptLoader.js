/**
 * üìå –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
 * 
 * üîπ –û–ø–∏—Å–∞–Ω–∏–µ:
 * –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å –ø—Ä–æ–º—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫
 * –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –ü—Ä–æ–º—Ç —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ `config.json`.
 * 
 * üîπ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
 * - –ï—Å–ª–∏ `prompt_file` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `config.json`, –≤—ã–≤–æ–¥–∏—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
 * - –ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.
 * - –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –ø—Ä–æ–º—Ç–µ (–ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏).
 * 
 * üîπ –ü—Ä–∏–º–µ—Ä `config.json`:
 * ```json
 * {
 *   "prompt_file": "prompt.txt"
 * }
 * ```
 */

import fs from 'fs';
import path from 'path';

export function loadInitialPrompt(targetDirectory, config) {
    if (!config.prompt_file) {
        console.log('‚ÑπÔ∏è –ü—Ä–æ–º—Ç –Ω–µ —É–∫–∞–∑–∞–Ω –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.');
        return '';
    }

    const promptFilePath = path.join(targetDirectory, config.prompt_file);
    if (!fs.existsSync(promptFilePath)) {
        console.error(`‚ùå –§–∞–π–ª —Å –ø—Ä–æ–º—Ç–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω: ${promptFilePath}`);
        process.exit(1);
    }

    const promptContent = fs.readFileSync(promptFilePath, 'utf8').trim();
    
    // –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –ø—Ä–æ–º—Ç–µ (–ø–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏)
    console.log(`‚úÖ –ü—Ä–æ–º—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω (${config.prompt_file}): ${promptContent.split('\n')[0]}...`);

    return promptContent;
}
